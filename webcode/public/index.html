<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <!-- ป้องกัน pinch-zoom / double-tap zoom บนมือถือ -->
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
    <!-- iOS PWA -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />

    <title>Web Terminal — App Mode</title>

    <!-- PWA manifest -->
    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css" />

    <style>
      html, body {
        height: 100%;
        margin: 0;
        background: #0b0f14;
        color: #fff;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        -webkit-touch-callout: none; /* reduce accidental text selection on iOS */
      }

      /* layout */
      .toolbar {
        display: flex;
        gap: 8px;
        padding: 8px;
        background: #071722;
        align-items: center;
        justify-content: space-between;
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation; /* help prevent double-tap zoom on some platforms */
      }
      .left, .right { display:flex; gap:8px; align-items:center; }
      .btn {
        padding: 8px 10px;
        border-radius: 8px;
        background: #0f1720;
        color: #fff;
        border: 1px solid #23303a;
        font-weight: 600;
      }
      .modifier { min-width: 60px; }
      .active { background: linear-gradient(180deg,#1f6a9b,#164d74); }

      /* terminal area occupies remaining height; ensure no overflow */
      #term {
        flex: 1;
        height: calc(100vh - 56px); /* toolbar ~56px */
        min-height: 120px;
        overflow: hidden;
      }

      /* small helpers */
      .install-hint {
        font-size: 12px;
        color: #9fb9c9;
        padding: 6px 10px;
      }

      /* ensure toolbar buttons are touch-friendly */
      button { -webkit-tap-highlight-color: rgba(0,0,0,0.2); }
    </style>
  </head>

  <body>
    <div class="toolbar" role="toolbar" aria-label="special keys toolbar">
      <div class="left">
        <button id="btn-ctrl" class="btn modifier" data-mod="ctrl">Ctrl</button>
        <button id="btn-alt"  class="btn modifier" data-mod="alt">Alt</button>

        <button id="btn-esc"  class="btn" data-send="esc">Esc</button>
        <button id="btn-tab"  class="btn" data-send="tab">Tab</button>

        <div style="width:1px;height:32px;background:#1b2a30;margin:0 8px;"></div>

        <button id="btn-left" class="btn" data-arrow="left">←</button>
        <button id="btn-up"   class="btn" data-arrow="up">↑</button>
        <button id="btn-down" class="btn" data-arrow="down">↓</button>
        <button id="btn-right"class="btn" data-arrow="right">→</button>
      </div>

      <div class="right">
        <button id="btn-keyboard" class="btn">Keyboard</button>
        <button id="btn-paste" class="btn">Paste</button>
        <!-- Android install prompt will show this when available -->
        <button id="btn-install" class="btn" style="display:none">Install</button>
      </div>
    </div>

    <div id="term" role="application" aria-label="terminal"></div>

    <!-- hidden input to reliably bring up iOS on-screen keyboard -->
    <input id="hidden-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
           style="position:absolute;left:-9999px;top:-9999px;opacity:0;width:1px;height:1px;" />

    <div class="install-hint" id="install-hint">
      ติดตั��ง: เปิดเมนู Share → Add to Home Screen (iOS) หรือกด Install (Android) เพื่อใช้งานแบบแอป
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
    <script src="app.js"></script>
    <script>
      // register simple service worker for PWA (sw.js must exist)
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').catch(()=>{ /* ignore errors */ });
      }
    </script>
  </body>
</html>
